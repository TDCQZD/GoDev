<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600243 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 16pt;
    }
  </style>
</head>
<body>
<a name="937"/>
<h1>01_创建服务器&amp;Http协议&amp;操作数据库</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2018/9/3 16:34</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2018/9/3 17:13</i></td></tr>
<tr><td><b>作者：</b></td><td><i>韩延兵</i></td></tr>
</table>
</div>
<br/>

<div>
<span><div><div>01.创建服务器</div><ul><li><div>使用net/http包</div></li><li><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">通过处理器函数处理请求</span></div></li><ul><li><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">创建服务器的步骤</span>：</div></li><ul><li><div>1）创建一个函数处理器，函数的入参必须是http.ResponseWriter和http.Request指针类型</div></li><li><div>2）在main函数中调用http中的HandleFunc函数指定处理指定请求的处理器</div></li><ul><li><div>HandleFun函数能自动将1）中的函数转换为处理器</div></li></ul><li><div>3）设置路由</div></li><li><div>具体代码</div></li></ul></ul></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(86, 156, 214);">package</span> <span style="color: rgb(212, 212, 212);">main</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><br style="color: rgb(51, 51, 51);"/></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(86, 156, 214);">import</span> <span style="color: rgb(212, 212, 212);">(</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    </span><span style="color: rgb(206, 145, 120);">&quot;fmt&quot;</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    </span><span style="color: rgb(206, 145, 120);">&quot;net/http&quot;</span></font></div><div><span style="color: rgb(212, 212, 212);"><font face="Consolas" style="font-size: 16pt;">)</font></span></div><div><font face="Consolas" style="font-size: 16pt;"><br style="color: rgb(51, 51, 51);"/></font></div><div><span style="color: rgb(106, 153, 85);"><font face="Consolas" style="font-size: 16pt;">//创建处理器函数</font></span></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(86, 156, 214);">func</span> <span style="color: rgb(220, 220, 170);">handler</span><span style="color: rgb(212, 212, 212);">(w http.ResponseWriter, r</span> <span style="color: rgb(212, 212, 212);">*</span><span style="color: rgb(212, 212, 212);">http.Request) {</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    fmt.</span><span style="color: rgb(220, 220, 170);">Fprintln</span><span style="color: rgb(212, 212, 212);">(w,</span> <span style="color: rgb(206, 145, 120);">&quot;Hello World!&quot;</span><span style="color: rgb(212, 212, 212);">, r.URL.Path)</span></font></div><div><span style="color: rgb(212, 212, 212);"><font face="Consolas" style="font-size: 16pt;">}</font></span></div><div><font face="Consolas" style="font-size: 16pt;"><br style="color: rgb(51, 51, 51);"/></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(86, 156, 214);">func</span> <span style="color: rgb(220, 220, 170);">main</span><span style="color: rgb(212, 212, 212);">() {</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><br style="color: rgb(51, 51, 51);"/></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    http.</span><span style="color: rgb(220, 220, 170);">HandleFunc</span><span style="color: rgb(212, 212, 212);">(</span><span style="color: rgb(206, 145, 120);">&quot;/&quot;</span><span style="color: rgb(212, 212, 212);">, handler)</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><br style="color: rgb(51, 51, 51);"/></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    </span><span style="color: rgb(106, 153, 85);">//创建路由</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    http.</span><span style="color: rgb(220, 220, 170);">ListenAndServe</span><span style="color: rgb(212, 212, 212);">(</span><span style="color: rgb(206, 145, 120);">&quot;:8080&quot;</span><span style="color: rgb(212, 212, 212);">,</span> <span style="color: rgb(86, 156, 214);">nil</span><span style="color: rgb(212, 212, 212);">)</span></font></div><div><span style="color: rgb(212, 212, 212);"><font face="Consolas" style="font-size: 16pt;">}</font></span></div></div><ul><li><div>创建服务器的其他方式</div></li><ul><li><div>通过处理器处理请求</div></li><ul><li><div>处理器需要实现Handler接口中的ServHTTP方法</div></li></ul></ul></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(86, 156, 214);">package</span> <span style="color: rgb(212, 212, 212);">main</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><br style="color: rgb(51, 51, 51);"/></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(86, 156, 214);">import</span> <span style="color: rgb(212, 212, 212);">(</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    </span><span style="color: rgb(206, 145, 120);">&quot;fmt&quot;</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    </span><span style="color: rgb(206, 145, 120);">&quot;net/http&quot;</span></font></div><div><span style="color: rgb(212, 212, 212);"><font face="Consolas" style="font-size: 16pt;">)</font></span></div><div><font face="Consolas" style="font-size: 16pt;"><br style="color: rgb(51, 51, 51);"/></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(86, 156, 214);">type</span> <span style="color: rgb(78, 201, 176);">MyHandler</span> <span style="color: rgb(86, 156, 214);">struct</span><span style="color: rgb(212, 212, 212);">{}</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><br style="color: rgb(51, 51, 51);"/></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(86, 156, 214);">func</span> <span style="color: rgb(212, 212, 212);">(m</span> <span style="color: rgb(212, 212, 212);">*</span><span style="color: rgb(212, 212, 212);">MyHandler)</span> <span style="color: rgb(220, 220, 170);">ServeHTTP</span><span style="color: rgb(212, 212, 212);">(w http.ResponseWriter, r</span> <span style="color: rgb(212, 212, 212);">*</span><span style="color: rgb(212, 212, 212);">http.Request) {</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    fmt.</span><span style="color: rgb(220, 220, 170);">Fprintln</span><span style="color: rgb(212, 212, 212);">(w,</span> <span style="color: rgb(206, 145, 120);">&quot;通过自己创建的处理器处理请求！&quot;</span><span style="color: rgb(212, 212, 212);">)</span></font></div><div><span style="color: rgb(212, 212, 212);"><font face="Consolas" style="font-size: 16pt;">}</font></span></div><div><font face="Consolas" style="font-size: 16pt;"><br style="color: rgb(51, 51, 51);"/></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(86, 156, 214);">func</span> <span style="color: rgb(220, 220, 170);">main</span><span style="color: rgb(212, 212, 212);">() {</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><br style="color: rgb(51, 51, 51);"/></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    </span><span style="color: rgb(156, 220, 254);">myHandler</span> <span style="color: rgb(212, 212, 212);">:=</span> <span style="color: rgb(212, 212, 212);">MyHandler{}</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><br style="color: rgb(51, 51, 51);"/></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    http.</span><span style="color: rgb(220, 220, 170);">Handle</span><span style="color: rgb(212, 212, 212);">(</span><span style="color: rgb(206, 145, 120);">&quot;/myHandler&quot;</span><span style="color: rgb(212, 212, 212);">,</span> <span style="color: rgb(212, 212, 212);">&amp;</span><span style="color: rgb(212, 212, 212);">myHandler)</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><br style="color: rgb(51, 51, 51);"/></font></div><div><font style="font-size: 16pt; font-family: Consolas;"><span style="color: rgb(212, 212, 212);">    http.</span><span style="color: rgb(220, 220, 170);">ListenAndServe</span><span style="color: rgb(212, 212, 212);">(</span><span style="color: rgb(206, 145, 120);">&quot;:8080&quot;</span><span style="color: rgb(212, 212, 212);">,</span> <span style="color: rgb(86, 156, 214);">nil</span><span style="color: rgb(212, 212, 212);">)</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><br style="color: rgb(51, 51, 51);"/></font></div><div><span style="color: rgb(212, 212, 212);"><font face="Consolas" style="font-size: 16pt;">}</font></span></div></div><ul><li><div>通过详细配置服务器中的参数</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(86, 156, 214);">package</span> <span style="color: rgb(212, 212, 212);">main</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><br style="color: rgb(51, 51, 51);"/></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(86, 156, 214);">import</span> <span style="color: rgb(212, 212, 212);">(</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    </span><span style="color: rgb(206, 145, 120);">&quot;fmt&quot;</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    </span><span style="color: rgb(206, 145, 120);">&quot;net/http&quot;</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    </span><span style="color: rgb(206, 145, 120);">&quot;time&quot;</span></font></div><div><span style="color: rgb(212, 212, 212);"><font face="Consolas" style="font-size: 16pt;">)</font></span></div><div><font face="Consolas" style="font-size: 16pt;"><br style="color: rgb(51, 51, 51);"/></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(86, 156, 214);">type</span> <span style="color: rgb(78, 201, 176);">MyHandler</span> <span style="color: rgb(86, 156, 214);">struct</span><span style="color: rgb(212, 212, 212);">{}</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><br style="color: rgb(51, 51, 51);"/></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(86, 156, 214);">func</span> <span style="color: rgb(212, 212, 212);">(m</span> <span style="color: rgb(212, 212, 212);">*</span><span style="color: rgb(212, 212, 212);">MyHandler)</span> <span style="color: rgb(220, 220, 170);">ServeHTTP</span><span style="color: rgb(212, 212, 212);">(w http.ResponseWriter, r</span> <span style="color: rgb(212, 212, 212);">*</span><span style="color: rgb(212, 212, 212);">http.Request) {</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    fmt.</span><span style="color: rgb(220, 220, 170);">Fprintln</span><span style="color: rgb(212, 212, 212);">(w,</span> <span style="color: rgb(206, 145, 120);">&quot;通过详细配置服务器的信息来处理请求！&quot;</span><span style="color: rgb(212, 212, 212);">)</span></font></div><div><span style="color: rgb(212, 212, 212);"><font face="Consolas" style="font-size: 16pt;">}</font></span></div><div><font face="Consolas" style="font-size: 16pt;"><br style="color: rgb(51, 51, 51);"/></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(86, 156, 214);">func</span> <span style="color: rgb(220, 220, 170);">main</span><span style="color: rgb(212, 212, 212);">() {</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><br style="color: rgb(51, 51, 51);"/></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    </span><span style="color: rgb(156, 220, 254);">myHandler</span> <span style="color: rgb(212, 212, 212);">:=</span> <span style="color: rgb(212, 212, 212);">MyHandler{}</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><br style="color: rgb(51, 51, 51);"/></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    </span><span style="color: rgb(106, 153, 85);">//创建Server结构，并详细配置里面的字段</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    </span><span style="color: rgb(156, 220, 254);">server</span> <span style="color: rgb(212, 212, 212);">:=</span> <span style="color: rgb(212, 212, 212);">http.Server{</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">        Addr:</span> <span style="color: rgb(206, 145, 120);">&quot;:8080&quot;</span><span style="color: rgb(212, 212, 212);">,</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">        Handler:</span> <span style="color: rgb(212, 212, 212);">&amp;</span><span style="color: rgb(212, 212, 212);">myHandler,</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">        ReadTimeout:</span> <span style="color: rgb(181, 206, 168);">2</span> <span style="color: rgb(212, 212, 212);">*</span> <span style="color: rgb(212, 212, 212);">time.Second,</span></font></div><div><span style="color: rgb(212, 212, 212);"><font face="Consolas" style="font-size: 16pt;">    }</font></span></div><div><font face="Consolas" style="font-size: 16pt;"><br style="color: rgb(51, 51, 51);"/></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    server.</span><span style="color: rgb(220, 220, 170);">ListenAndServe</span><span style="color: rgb(212, 212, 212);">()</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><br style="color: rgb(51, 51, 51);"/></font></div><div><span style="color: rgb(212, 212, 212);"><font face="Consolas" style="font-size: 16pt;">}</font></span></div></div><ul><li><div>通过自定义多路复用器</div></li><ul><li><div>以上的方式在调用ListenAndServe(&quot;:8080&quot;, nil)时第二个参数传入的都是nil，使用的都是默认的多路复用器DefaultServeMux，我们也可以自己创建多路复用器</div></li></ul></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(86, 156, 214);">package</span> <span style="color: rgb(212, 212, 212);">main</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><br style="color: rgb(51, 51, 51);"/></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(86, 156, 214);">import</span> <span style="color: rgb(212, 212, 212);">(</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    </span><span style="color: rgb(206, 145, 120);">&quot;fmt&quot;</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    </span><span style="color: rgb(206, 145, 120);">&quot;net/http&quot;</span></font></div><div><span style="color: rgb(212, 212, 212);"><font face="Consolas" style="font-size: 16pt;">)</font></span></div><div><font face="Consolas" style="font-size: 16pt;"><br style="color: rgb(51, 51, 51);"/></font></div><div><span style="color: rgb(106, 153, 85);"><font face="Consolas" style="font-size: 16pt;">//创建处理器函数</font></span></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(86, 156, 214);">func</span> <span style="color: rgb(220, 220, 170);">handler</span><span style="color: rgb(212, 212, 212);">(w http.ResponseWriter, r</span> <span style="color: rgb(212, 212, 212);">*</span><span style="color: rgb(212, 212, 212);">http.Request) {</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    fmt.</span><span style="color: rgb(220, 220, 170);">Fprintln</span><span style="color: rgb(212, 212, 212);">(w,</span> <span style="color: rgb(206, 145, 120);">&quot;通过自己创建的多路复用器处理请求!&quot;</span><span style="color: rgb(212, 212, 212);">, r.URL.Path)</span></font></div><div><span style="color: rgb(212, 212, 212);"><font face="Consolas" style="font-size: 16pt;">}</font></span></div><div><font face="Consolas" style="font-size: 16pt;"><br style="color: rgb(51, 51, 51);"/></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(86, 156, 214);">func</span> <span style="color: rgb(220, 220, 170);">main</span><span style="color: rgb(212, 212, 212);">() {</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    </span><span style="color: rgb(106, 153, 85);">//创建多路复用器</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    </span><span style="color: rgb(156, 220, 254);">mux</span> <span style="color: rgb(212, 212, 212);">:=</span> <span style="color: rgb(212, 212, 212);">http.</span><span style="color: rgb(220, 220, 170);">NewServeMux</span><span style="color: rgb(212, 212, 212);">()</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><br style="color: rgb(51, 51, 51);"/></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    mux.</span><span style="color: rgb(220, 220, 170);">HandleFunc</span><span style="color: rgb(212, 212, 212);">(</span><span style="color: rgb(206, 145, 120);">&quot;/&quot;</span><span style="color: rgb(212, 212, 212);">, handler)</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><br style="color: rgb(51, 51, 51);"/></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    </span><span style="color: rgb(106, 153, 85);">//创建路由</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    http.</span><span style="color: rgb(220, 220, 170);">ListenAndServe</span><span style="color: rgb(212, 212, 212);">(</span><span style="color: rgb(206, 145, 120);">&quot;:8080&quot;</span><span style="color: rgb(212, 212, 212);">, mux)</span></font></div><div><span style="color: rgb(212, 212, 212);"><font face="Consolas" style="font-size: 16pt;">}</font></span></div></div><div>2.Http协议</div><ul><li><div>客户端与服务器端交互需要遵守一定的规则，这个规则就是Http协议（Hypertext transfer protocol），超文本传输协议。</div></li><li><div>客户端与服务器端通信时传输的内容称为<span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">报文</span></div></li><li><div>客户端发送给服务器端的报文称为<span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">请求报文</span></div></li><li><div>服务器端发送给客户端的报文称为<span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">响应报文</span></div></li><li><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">请求报文的格式</span></div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>请求行</div><div>请求头</div><div><br/></div><div>请求体（get请求没有请求体）</div></div><ul><li><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">响应报文的格式</span></div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>响应行</div><div>响应头</div><div><br/></div><div>响应体</div></div><ul><li><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">常见的状态码</span></div></li><ul><li><div>200：请求成功，浏览器会把响应体内容（通常是html）显示在浏览器中</div></li><li><div>404：请求的资源没有找到，说明客户端错误的请求了不存在的资源</div></li><li><div>500：请求资源找到了，但服务器内部出现了错误</div></li><li><div>302：重定向，当响应码为302时，表示服务器要求浏览器重新再发一个请求，服务器会发送一个响应头Location，它指定了新请求的URL地址</div></li></ul></ul><div>4.<span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">操作数据库</span></div><ul><li><div>使用database/sql包</div></li><li><div>由于Go官方没有提供数据库的驱动，所以需要导入第三方的驱动包go-sql-driver</div></li><li><div>对数据库操作需要用到的方法：</div></li><ul><li><div>Prepare方法（DB结构中的方法）</div></li><ul><li><div>预编译操作</div></li></ul><li><div>Exec方法（DB结构或者Stmt结构中的方法）</div></li><ul><li><div>执行增删改操作</div></li></ul></ul></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(86, 156, 214);">package</span> <span style="color: rgb(212, 212, 212);">model</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><br style="color: rgb(51, 51, 51);"/></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(86, 156, 214);">import</span> <span style="color: rgb(212, 212, 212);">(</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    </span><span style="color: rgb(206, 145, 120);">&quot;fmt&quot;</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    </span><span style="color: rgb(206, 145, 120);">&quot;web01_db/utils&quot;</span></font></div><div><span style="color: rgb(212, 212, 212);"><font face="Consolas" style="font-size: 16pt;">)</font></span></div><div><font face="Consolas" style="font-size: 16pt;"><br style="color: rgb(51, 51, 51);"/></font></div><div><span style="color: rgb(106, 153, 85);"><font face="Consolas" style="font-size: 16pt;">//User 结构体</font></span></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(86, 156, 214);">type</span> <span style="color: rgb(78, 201, 176);">User</span> <span style="color: rgb(86, 156, 214);">struct</span> <span style="color: rgb(212, 212, 212);">{</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    ID</span> <span style="color: rgb(78, 201, 176);">int</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    Username</span> <span style="color: rgb(78, 201, 176);">string</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    Password</span> <span style="color: rgb(78, 201, 176);">string</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    Email</span> <span style="color: rgb(78, 201, 176);">string</span></font></div><div><span style="color: rgb(212, 212, 212);"><font face="Consolas" style="font-size: 16pt;">}</font></span></div><div><font face="Consolas" style="font-size: 16pt;"><br style="color: rgb(51, 51, 51);"/></font></div><div><span style="color: rgb(106, 153, 85);"><font face="Consolas" style="font-size: 16pt;">//AddUser 添加User的方法一</font></span></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(86, 156, 214);">func</span> <span style="color: rgb(212, 212, 212);">(user</span> <span style="color: rgb(212, 212, 212);">*</span><span style="color: rgb(212, 212, 212);">User)</span> <span style="color: rgb(220, 220, 170);">AddUser</span><span style="color: rgb(212, 212, 212);">()</span> <span style="color: rgb(86, 156, 214);">error</span> <span style="color: rgb(212, 212, 212);">{</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    </span><span style="color: rgb(106, 153, 85);">//1.写sql语句</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    </span><span style="color: rgb(156, 220, 254);">sqlStr</span> <span style="color: rgb(212, 212, 212);">:=</span> <span style="color: rgb(206, 145, 120);">&quot;insert into users(username,password,email) values(?,?,?)&quot;</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    </span><span style="color: rgb(106, 153, 85);">//2.预编译</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    </span><span style="color: rgb(156, 220, 254);">inStmt</span><span style="color: rgb(212, 212, 212);">,</span> <span style="color: rgb(156, 220, 254);">err</span> <span style="color: rgb(212, 212, 212);">:=</span> <span style="color: rgb(212, 212, 212);">utils.Db.</span><span style="color: rgb(220, 220, 170);">Prepare</span><span style="color: rgb(212, 212, 212);">(sqlStr)</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    </span><span style="color: rgb(197, 134, 192);">if</span> <span style="color: rgb(212, 212, 212);">err</span> <span style="color: rgb(212, 212, 212);">!=</span> <span style="color: rgb(86, 156, 214);">nil</span> <span style="color: rgb(212, 212, 212);">{</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">        fmt.</span><span style="color: rgb(220, 220, 170);">Println</span><span style="color: rgb(212, 212, 212);">(</span><span style="color: rgb(206, 145, 120);">&quot;预编译出现异常：&quot;</span><span style="color: rgb(212, 212, 212);">, err)</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">        </span><span style="color: rgb(197, 134, 192);">return</span> <span style="color: rgb(212, 212, 212);">err</span></font></div><div><span style="color: rgb(212, 212, 212);"><font face="Consolas" style="font-size: 16pt;">    }</font></span></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    </span><span style="color: rgb(106, 153, 85);">//3.执行</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    </span><span style="color: rgb(156, 220, 254);">_</span><span style="color: rgb(212, 212, 212);">,</span> <span style="color: rgb(156, 220, 254);">err2</span> <span style="color: rgb(212, 212, 212);">:=</span> <span style="color: rgb(212, 212, 212);">inStmt.</span><span style="color: rgb(220, 220, 170);">Exec</span><span style="color: rgb(212, 212, 212);">(</span><span style="color: rgb(206, 145, 120);">&quot;admin&quot;</span><span style="color: rgb(212, 212, 212);">,</span> <span style="color: rgb(206, 145, 120);">&quot;123456&quot;</span><span style="color: rgb(212, 212, 212);">,</span> <span style="color: rgb(206, 145, 120);">&quot;<a href="mailto:admin@atguigu.com">admin@atguigu.com</a>&quot;</span><span style="color: rgb(212, 212, 212);">)</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    </span><span style="color: rgb(197, 134, 192);">if</span> <span style="color: rgb(212, 212, 212);">err2</span> <span style="color: rgb(212, 212, 212);">!=</span> <span style="color: rgb(86, 156, 214);">nil</span> <span style="color: rgb(212, 212, 212);">{</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">        fmt.</span><span style="color: rgb(220, 220, 170);">Println</span><span style="color: rgb(212, 212, 212);">(</span><span style="color: rgb(206, 145, 120);">&quot;执行出现异常：&quot;</span><span style="color: rgb(212, 212, 212);">, err2)</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">        </span><span style="color: rgb(197, 134, 192);">return</span> <span style="color: rgb(212, 212, 212);">err</span></font></div><div><span style="color: rgb(212, 212, 212);"><font face="Consolas" style="font-size: 16pt;">    }</font></span></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    </span><span style="color: rgb(197, 134, 192);">return</span> <span style="color: rgb(86, 156, 214);">nil</span></font></div><div><span style="color: rgb(212, 212, 212);"><font face="Consolas" style="font-size: 16pt;">}</font></span></div><div><font face="Consolas" style="font-size: 16pt;"><br style="color: rgb(51, 51, 51);"/></font></div><div><span style="color: rgb(106, 153, 85);"><font face="Consolas" style="font-size: 16pt;">//AddUser2 添加User的方法二</font></span></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(86, 156, 214);">func</span> <span style="color: rgb(212, 212, 212);">(user</span> <span style="color: rgb(212, 212, 212);">*</span><span style="color: rgb(212, 212, 212);">User)</span> <span style="color: rgb(220, 220, 170);">AddUser2</span><span style="color: rgb(212, 212, 212);">()</span> <span style="color: rgb(86, 156, 214);">error</span> <span style="color: rgb(212, 212, 212);">{</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    </span><span style="color: rgb(106, 153, 85);">//1.写sql语句</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    </span><span style="color: rgb(156, 220, 254);">sqlStr</span> <span style="color: rgb(212, 212, 212);">:=</span> <span style="color: rgb(206, 145, 120);">&quot;insert into users(username,password,email) values(?,?,?)&quot;</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    </span><span style="color: rgb(106, 153, 85);">//2.执行</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    </span><span style="color: rgb(156, 220, 254);">_</span><span style="color: rgb(212, 212, 212);">,</span> <span style="color: rgb(156, 220, 254);">err</span> <span style="color: rgb(212, 212, 212);">:=</span> <span style="color: rgb(212, 212, 212);">utils.Db.</span><span style="color: rgb(220, 220, 170);">Exec</span><span style="color: rgb(212, 212, 212);">(sqlStr,</span> <span style="color: rgb(206, 145, 120);">&quot;admin2&quot;</span><span style="color: rgb(212, 212, 212);">,</span> <span style="color: rgb(206, 145, 120);">&quot;666666&quot;</span><span style="color: rgb(212, 212, 212);">,</span> <span style="color: rgb(206, 145, 120);">&quot;<a href="mailto:admin2@sina.com">admin2@sina.com</a>&quot;</span><span style="color: rgb(212, 212, 212);">)</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    </span><span style="color: rgb(197, 134, 192);">if</span> <span style="color: rgb(212, 212, 212);">err</span> <span style="color: rgb(212, 212, 212);">!=</span> <span style="color: rgb(86, 156, 214);">nil</span> <span style="color: rgb(212, 212, 212);">{</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">        fmt.</span><span style="color: rgb(220, 220, 170);">Println</span><span style="color: rgb(212, 212, 212);">(</span><span style="color: rgb(206, 145, 120);">&quot;执行出现异常：&quot;</span><span style="color: rgb(212, 212, 212);">, err)</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">        </span><span style="color: rgb(197, 134, 192);">return</span> <span style="color: rgb(212, 212, 212);">err</span></font></div><div><span style="color: rgb(212, 212, 212);"><font face="Consolas" style="font-size: 16pt;">    }</font></span></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    </span><span style="color: rgb(197, 134, 192);">return</span> <span style="color: rgb(86, 156, 214);">nil</span></font></div><div><span style="color: rgb(212, 212, 212);"><font face="Consolas" style="font-size: 16pt;">}</font></span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div></div><div>5.单元测试</div><ul><li><div>使用testing包</div></li><li><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">测试文件的要求</span>：</div></li></ul><ul><ul><li><div>测试文件必须以_test.go结尾</div></li><li><div>测试文件要与被测试文件在同一个包下</div></li><li><div>测试函数必须以Test开发</div></li><li><div>TestXxx测试函数的Xxx的第一个字母必须是大写的英文字母，如：TestUser(t *testing.T)</div></li><li><div>测试函数中的参数是*testing.T类型</div></li></ul><li><div>我们还可以通过TestMain(m *testing.m)函数在测试函数之前执行一些其他操作，然后调用m.Run()执行测试函数</div></li><li><div>我们也可以创建子测试函数，然后在测试函数中通过t.Run(&quot;&quot; ,自测试函数的函数名)的方式调用子测试函数</div></li><ul><li><div>具体代码</div></li></ul></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(86, 156, 214);">package</span> <span style="color: rgb(212, 212, 212);">model</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><br style="color: rgb(51, 51, 51);"/></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(86, 156, 214);">import</span> <span style="color: rgb(212, 212, 212);">(</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    </span><span style="color: rgb(206, 145, 120);">&quot;fmt&quot;</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    </span><span style="color: rgb(206, 145, 120);">&quot;testing&quot;</span></font></div><div><span style="color: rgb(212, 212, 212);"><font face="Consolas" style="font-size: 16pt;">)</font></span></div><div><font face="Consolas" style="font-size: 16pt;"><br style="color: rgb(51, 51, 51);"/></font></div><div><span style="color: rgb(106, 153, 85);"><font face="Consolas" style="font-size: 16pt;">//TestMain函数可以在测试函数执行之前做一些其他操作</font></span></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(86, 156, 214);">func</span> <span style="color: rgb(220, 220, 170);">TestMain</span><span style="color: rgb(212, 212, 212);">(m</span> <span style="color: rgb(212, 212, 212);">*</span><span style="color: rgb(212, 212, 212);">testing.M) {</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    fmt.</span><span style="color: rgb(220, 220, 170);">Println</span><span style="color: rgb(212, 212, 212);">(</span><span style="color: rgb(206, 145, 120);">&quot;测试开始：&quot;</span><span style="color: rgb(212, 212, 212);">)</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    </span><span style="color: rgb(106, 153, 85);">//通过m.Run()来执行测试函数</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    m.</span><span style="color: rgb(220, 220, 170);">Run</span><span style="color: rgb(212, 212, 212);">()</span></font></div><div><span style="color: rgb(212, 212, 212);"><font face="Consolas" style="font-size: 16pt;">}</font></span></div><div><font face="Consolas" style="font-size: 16pt;"><br style="color: rgb(51, 51, 51);"/></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(86, 156, 214);">func</span> <span style="color: rgb(220, 220, 170);">TestUser</span><span style="color: rgb(212, 212, 212);">(t</span> <span style="color: rgb(212, 212, 212);">*</span><span style="color: rgb(212, 212, 212);">testing.T) {</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    fmt.</span><span style="color: rgb(220, 220, 170);">Println</span><span style="color: rgb(212, 212, 212);">(</span><span style="color: rgb(206, 145, 120);">&quot;开始测试User中的相关方法&quot;</span><span style="color: rgb(212, 212, 212);">)</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    </span><span style="color: rgb(106, 153, 85);">//通过t.Run()来执行子测试函数</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    t.</span><span style="color: rgb(220, 220, 170);">Run</span><span style="color: rgb(212, 212, 212);">(</span><span style="color: rgb(206, 145, 120);">&quot;测试添加用户:&quot;</span><span style="color: rgb(212, 212, 212);">, testAddUser)</span></font></div><div><span style="color: rgb(212, 212, 212);"><font face="Consolas" style="font-size: 16pt;">}</font></span></div><div><font face="Consolas" style="font-size: 16pt;"><br style="color: rgb(51, 51, 51);"/></font></div><div><span style="color: rgb(106, 153, 85);"><font face="Consolas" style="font-size: 16pt;">//如果函数名不是以Test开头，那么该函数默认不执行，我们可以将它设置成为一个子测试函数</font></span></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(86, 156, 214);">func</span> <span style="color: rgb(220, 220, 170);">testAddUser</span><span style="color: rgb(212, 212, 212);">(t</span> <span style="color: rgb(212, 212, 212);">*</span><span style="color: rgb(212, 212, 212);">testing.T) {</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    fmt.</span><span style="color: rgb(220, 220, 170);">Println</span><span style="color: rgb(212, 212, 212);">(</span><span style="color: rgb(206, 145, 120);">&quot;子测试函数执行：&quot;</span><span style="color: rgb(212, 212, 212);">)</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    </span><span style="color: rgb(106, 153, 85);">// user := &amp;User{}</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    </span><span style="color: rgb(106, 153, 85);">//调用添加用户的方法</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    </span><span style="color: rgb(106, 153, 85);">// user.AddUser()</span></font></div><div><font face="Consolas" style="font-size: 16pt;"><span style="color: rgb(212, 212, 212);">    </span><span style="color: rgb(106, 153, 85);">// user.AddUser2()</span></font></div><div><span style="color: rgb(212, 212, 212);"><font face="Consolas" style="font-size: 16pt;">}</font></span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div></div><div><br/></div></div></span>
</div></body></html> 